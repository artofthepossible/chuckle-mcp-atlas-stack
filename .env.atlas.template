# MongoDB Atlas Configuration Template
# Copy this file to .env.atlas and fill in your actual values
# Then run: docker compose -f compose.atlas.mcp.yaml --env-file .env.atlas up --build

# ============================================
# REQUIRED: MongoDB Atlas Connection
# ============================================
# Get this from Atlas -> Database -> Connect -> Drivers -> Connection String
# Format: mongodb+srv://<username>:<password>@<cluster>.mongodb.net/<database>?retryWrites=true&w=majority
MONGODB_URI=mongodb+srv://your-username:your-password@your-cluster.xxxxx.mongodb.net/docker-chuckles-prod?retryWrites=true&w=majority

# Database name (must match the one in your connection string)
MONGODB_DATABASE=docker-chuckles-prod

# ============================================
# Application Configuration
# ============================================
NODE_ENV=production
PORT=3001

# Auto-seed database on first run (set to false after initial setup)
AUTO_SEED=true

# ============================================
# Redis Configuration (Local Container)
# ============================================
REDIS_HOST=redis
REDIS_PORT=6379

# ============================================
# AWS Configuration (Optional)
# ============================================
# If your Atlas cluster is on AWS, specify the region
AWS_REGION=us-east-1

# ============================================
# MongoDB MCP Server Configuration
# ============================================
# Run MCP server in read-only mode (recommended for production)
MDB_MCP_READ_ONLY=true

# MCP Server port (internal)
MCP_SERVER_PORT=3002

# Debug logging for MCP server (optional)
# MCP_DEBUG=*
MCP_LOG_LEVEL=info

# ============================================
# MongoDB Atlas API Credentials (Optional)
# ============================================
# These are needed for advanced Atlas management features via MCP
# Get these from: Atlas -> Organization Access Manager -> API Keys
# Leave commented out if you don't need Atlas management features

# ATLAS_PUBLIC_KEY=your-atlas-public-key
# ATLAS_PRIVATE_KEY=your-atlas-private-key
# ATLAS_ORG_ID=your-organization-id
# ATLAS_PROJECT_ID=your-project-id

# ============================================
# Mongo Express UI Configuration (Optional)
# ============================================
# Basic auth credentials for Mongo Express admin UI
# Access at: http://localhost:8081
MONGO_EXPRESS_USER=admin
MONGO_EXPRESS_PASSWORD=changeme123

# Session secrets (generate random strings for production)
MONGO_EXPRESS_COOKIE_SECRET=randomcookiesecret123456
MONGO_EXPRESS_SESSION_SECRET=randomsessionsecret789012

# ============================================
# Setup Instructions
# ============================================
#
# 1. Create MongoDB Atlas Cluster:
#    - Go to https://cloud.mongodb.com/
#    - Create a new cluster (Free tier M0 is fine for testing)
#    - Choose AWS as provider (recommended)
#
# 2. Create Database User:
#    - Go to Security -> Database Access
#    - Add New Database User
#    - Choose Password authentication
#    - Set username and password
#    - Grant "Read and write to any database" role
#
# 3. Configure Network Access:
#    - Go to Security -> Network Access
#    - Click "Add IP Address"
#    - For testing: Choose "Allow Access from Anywhere" (0.0.0.0/0)
#    - For production: Add your specific IP address
#
# 4. Get Connection String:
#    - Go to Database -> Connect
#    - Choose "Connect your application"
#    - Copy the connection string
#    - Replace <password> with your actual password
#    - Replace <database> with: docker-chuckles-prod
#
# 5. Update This File:
#    - Copy this template: cp .env.atlas.template .env.atlas
#    - Edit .env.atlas with your connection string
#    - Update username, password, and cluster details
#
# 6. Start Services:
#    docker compose -f compose.atlas.mcp.yaml --env-file .env.atlas up --build
#
# 7. Access Application:
#    - App: http://localhost:3001
#    - Mongo Express UI: http://localhost:8081
#    - MCP Server: Running internally (accessible via MCP Gateway)
#
# ============================================
# Troubleshooting
# ============================================
#
# Connection Issues:
# - Verify your IP is whitelisted in Atlas Network Access
# - Check username and password are correct
# - Ensure connection string has the right format
# - Test connection: mongosh "your-connection-string"
#
# MCP Server Issues:
# - Check logs: docker compose -f compose.atlas.mcp.yaml logs mcp-server
# - Verify MongoDB URI is accessible from within container
# - Ensure Atlas firewall allows container network
#
# Mongo Express Issues:
# - Default credentials: admin / changeme123
# - Change these for production!
# - Access at: http://localhost:8081
#
# ============================================
